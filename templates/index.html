<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flask App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#000]">
    <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-sm ">
            <h2 class="mt-10 text-center text-2xl/9 font-bold tracking-tight text-white">CRM MobSys</h2>
        </div>

        <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">

            <div>
                <label for="email" class="block text-sm/6 font-medium text-gray-100">Email address</label>
                <div class="mt-2">
                <input id="email" type="email" name="email" required autocomplete="email" class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-[#4F81BD] sm:text-sm/6" />
                </div>
            </div>

            <div>
                <div class="flex items-center justify-between">
                <label for="password" class="block text-sm/6 font-medium text-gray-100">Password</label>
                </div>
                <div class="mt-2">
                <input id="password" type="password" name="password" required autocomplete="current-password" class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-[#4F81BD] sm:text-sm/6" />
                </div>
            </div>

            <div class="mt-5">
                <button id="loginBtn" type="button" class="flex w-full justify-center rounded-md bg-[#004080] px-3 py-1.5 text-sm/6 font-semibold text-white hover:bg-[#4F81BD] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">Sign in</button>
            </div>
        </div>
    </div>
</body>
<script>
    const loginDaten = document.getElementById("loginBtn");
    loginDaten.addEventListener("click", loginFunction);

    async function loginFunction(){
        try{
            const loginRes = await fetch("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyCOK7g5HzEXhSEt7N2rWSF4S1BuHoK46tc", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    "email": document.getElementById("email").value,
                    "password": document.getElementById("password").value,
                    "returnSecureToken": "true"
                })
            });
            const stream = await loginRes.json();
            console.log(parseJwt(stream["idToken"]));

            document.cookie = "token="+(parseJwt(stream["idToken"]))["user_id"];

            window.location.href="/home";
        }
        catch {
            alert("Login nicht erfolgreich. Email und Passwort 端berpr端fen.");
            throw new Error("Login nicht erfolgreich. Email und Passwort 端berpr端fen.");
            
        }
    };

    function parseJwt (token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        return JSON.parse(jsonPayload);
    }


</script>
</html>
